<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC 
        "-//mybatis.org//DTD Mapper 3.0//EN" 
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.persistence.ApplyMapper">


	<resultMap type="com.example.domain.RegistCourseInfo" id="RegistCourseInfoResultMap">
		<result property="no" column="no"/>
		<result property="name" column="name"/>
		<result property="thedate" column="thedate"/>
		<result property="start" column="start"/>
		<result property="end" column="end"/>
		<result property="extra" column="extra"/>
	</resultMap>

	<select id="getApplyList" resultMap="RegistCourseInfoResultMap" >
		SELECT c.course_no no, c.course_name name, c.the_date thedate, c.start_time start, c.end_time end, c.capacity-(IFNULL(COUNT(ca.course_no),0)) extra
		FROM course c
		LEFT JOIN course_apply ca
		ON c.course_no = ca.course_no
		WHERE c.the_date > NOW()
		GROUP BY c.course_no
		ORDER BY c.the_date ASC
		LIMIT 5;
	</select>
	
</mapper>